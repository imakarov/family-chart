# CloudKit Sync Architecture ‚Äî Family Chart

## –û–±–∑–æ—Ä

Family Chart –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Local-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** —Å **–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ CloudKit**.

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

1. **–õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î = –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã** ‚Äî –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (Hive/Isar)
2. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ë–ï–ó –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞** ‚Äî –ø–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å offline
3. **CloudKit = –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π sync layer** ‚Äî –≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. **–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** ‚Äî CloudKit –∏—Å–ø–æ–ª—å–∑—É–µ—Ç iCloud –∞–∫–∫–∞—É–Ω—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
5. **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ** ‚Äî –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   UI Layer                      ‚îÇ
‚îÇ  (Weekly Board, Dashboard, Settings)            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Repository Pattern                 ‚îÇ
‚îÇ  ‚Ä¢ –í—Å–µ–≥–¥–∞ —á–∏—Ç–∞–µ—Ç –∏–∑ Local DB                    ‚îÇ
‚îÇ  ‚Ä¢ –í—Å–µ–≥–¥–∞ –ø–∏—à–µ—Ç –≤ Local DB                      ‚îÇ
‚îÇ  ‚Ä¢ –¢—Ä–∏–≥–≥–µ—Ä–∏—Ç CloudKitSync (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ                           ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Local DB     ‚îÇ    ‚îÇ   CloudKit Sync      ‚îÇ
‚îÇ   (Hive/Isar)  ‚îÇ    ‚îÇ   (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)      ‚îÇ
‚îÇ                ‚îÇ    ‚îÇ                      ‚îÇ
‚îÇ  ‚Ä¢ Offline ‚úÖ  ‚îÇ    ‚îÇ  ‚Ä¢ –ï—Å–ª–∏ iCloud ‚úÖ    ‚îÇ
‚îÇ  ‚Ä¢ –í—Å–µ–≥–¥–∞      ‚îÇ    ‚îÇ  ‚Ä¢ –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å   ‚îÇ
‚îÇ    —Ä–∞–±–æ—Ç–∞–µ—Ç    ‚îÇ    ‚îÇ  ‚Ä¢ –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   iCloud (CloudKit) ‚îÇ
                    ‚îÇ  ‚Ä¢ Private Database ‚îÇ
                    ‚îÇ  ‚Ä¢ Shared Database  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## CloudKit Schema

### Record Types

#### 1. Checklist
```swift
RecordType: "Checklist"
Fields:
  - id: String (UUID)
  - name: String
  - startDate: Date
  - endDate: Date
  - isRepeating: Bool
  - createdBy: String (user identifier)
  - createdAt: Date
  - modifiedAt: Date
```

#### 2. Person
```swift
RecordType: "Person"
Fields:
  - id: String (UUID)
  - name: String
  - avatar: Asset (CKAsset - —Ñ–æ—Ç–æ)
  - color: String (hex)
  - checklistId: Reference(Checklist)
  - createdAt: Date
  - modifiedAt: Date
```

#### 3. Task
```swift
RecordType: "Task"
Fields:
  - id: String (UUID)
  - title: String
  - icon: String (icon identifier)
  - frequency: String (daily/weekly/custom)
  - frequencyData: String (JSON –¥–ª—è custom frequency)
  - assignedTo: Reference(Person)
  - checklistId: Reference(Checklist)
  - createdAt: Date
  - modifiedAt: Date
```

#### 4. TaskCompletion
```swift
RecordType: "TaskCompletion"
Fields:
  - id: String (UUID)
  - taskId: Reference(Task)
  - personId: Reference(Person)
  - checklistId: Reference(Checklist)
  - date: Date (–¥–µ–Ω—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
  - isCompleted: Bool
  - completedAt: Date (timestamp)
  - completedBy: String (deviceId)
  - modifiedAt: Date
```

**–ü–æ—á–µ–º—É –≥—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø–∏—Å–∏:**
- –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏
- –ö–∞–∂–¥–∞—è –æ—Ç–º–µ—Ç–∫–∞ = –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è –∑–∞–ø–∏—Å—å
- Append-only –¥–ª—è TaskCompletion

---

## –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: –ö–æ–≥–¥–∞ –≤–∫–ª—é—á–∞–µ—Ç—Å—è?

### –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è CloudKit:

#### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –≤—Ç–æ—Ä–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ iPad:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üì± –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤           ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ iCloud –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫     ‚îÇ
‚îÇ —á–µ–∫–ª–∏—Å—Ç–∞–º –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö        ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ [–í–∫–ª—é—á–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é]             ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ –∏–ª–∏                                  ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ [–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ]   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 2. –ù–∞–∂–∞—Ç–∏–µ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —á–µ–∫–ª–∏—Å—Ç–æ–º"
```
if (iCloudAvailable) {
  createShare() ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å Share Sheet
} else {
  –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ø–∞–ø:
  "–î–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è iCloud"
  [–û—Ç–∫—Ä—ã—Ç—å –ù–∞—Å—Ç—Ä–æ–π–∫–∏] [–û—Ç–º–µ–Ω–∞]
}
```

#### 3. Settings ‚Üí –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
```
Settings screen:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ iCloud –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è         [ON]   ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ –í—Å–µ —á–µ–∫–ª–∏—Å—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ ‚îÇ
‚îÇ –≤–∞—à iCloud –∞–∫–∫–∞—É–Ω—Ç                   ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: 2 –º–∏–Ω –Ω–∞–∑–∞–¥ ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:                          ‚îÇ
‚îÇ ‚Ä¢ iPhone 15 Pro (—ç—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)    ‚îÇ
‚îÇ ‚Ä¢ iPad Air                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 4. –î–µ–ª–∏–∫–∞—Ç–Ω—ã–π banner (–ø–æ—Å–ª–µ 3+ –¥–Ω–µ–π)
```
Dashboard, –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞ iPad?              ‚îÇ
‚îÇ    –í–∫–ª—é—á–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é            ‚îÇ  [√ó]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –°—Ç–æ–∏–º–æ—Å—Ç—å

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:
**‚úÖ –ë–ï–°–ü–õ–ê–¢–ù–û** (–¥–æ –ª–∏–º–∏—Ç–æ–≤)
- 1 PB –ø—É–±–ª–∏—á–Ω–æ–π –ë–î
- 10 TB –ø—Ä–∏–≤–∞—Ç–Ω–æ–π –ë–î –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- 2 GB asset storage –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ requests –¥–ª—è authenticated users

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
**‚úÖ –ë–ï–°–ü–õ–ê–¢–ù–û**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π iCloud –∞–∫–∫–∞—É–Ω—Ç
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è iCloud+ –ø–æ–¥–ø–∏—Å–∫–∞

---

## Conflict Resolution

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç completed –∑–∞–¥–∞—á–∞–º

```dart
ConflictResolver {
  // –ü—Ä–∞–≤–∏–ª–æ 1: Completed –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç –Ω–∞–¥ uncompleted
  if (localRecord.isCompleted && !serverRecord.isCompleted) {
    return localRecord;  // ‚úì –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç
  }
  if (!localRecord.isCompleted && serverRecord.isCompleted) {
    return serverRecord;  // ‚úì –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç
  }

  // –ü—Ä–∞–≤–∏–ª–æ 2: –ï—Å–ª–∏ –æ–±–µ ‚úì –∏–ª–∏ –æ–±–µ ‚úó ‚Äî –ø–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–∞–≤–∫–∞
  if (localRecord.modifiedAt > serverRecord.modifiedAt) {
    return localRecord;
  } else {
    return serverRecord;
  }
}
```

---

## –ú–∏–≥—Ä–∞—Ü–∏—è: Local ‚Üí Cloud

### –°—Ü–µ–Ω–∞—Ä–∏–π: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∫–ª—é—á–∏–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

```dart
Future<void> migrateLocalToCloud() async {
  // 1. –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  final localChecklists = await localDB.getAllChecklists();
  final localTasks = await localDB.getAllTasks();
  final localCompletions = await localDB.getAllCompletions();

  // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º: –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ CloudKit?
  final cloudChecklists = await cloudKit.fetchAll();

  if (cloudChecklists.isEmpty) {
    // –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å iCloud ‚Üí –ø—Ä–æ—Å—Ç–æ –∑–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ
    await cloudKit.uploadAll({
      'checklists': localChecklists,
      'tasks': localTasks,
      'completions': localCompletions,
    });
  } else {
    // –£–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ iCloud (—Å –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
    // –ú–µ—Ä–∂–∏–º intelligent merge
    final merged = mergeRecords(
      local: localChecklists,
      cloud: cloudChecklists,
    );

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Local DB
    await localDB.replaceAll(merged);

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –≤ CloudKit
    final uniqueLocal = findUniqueLocal(localChecklists, cloudChecklists);
    await cloudKit.uploadAll(uniqueLocal);
  }
}
```

---

## –°–∫–æ—Ä–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

| –î–µ–π—Å—Ç–≤–∏–µ | –í—Ä–µ–º—è |
|----------|-------|
| –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É | 1-3 —Å–µ–∫ |
| –°–æ–∑–¥–∞—Ç—å —á–µ–∫–ª–∏—Å—Ç | 2-5 —Å–µ–∫ |
| –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ | 1-10 —Å–µ–∫ |
| –§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è | –ö–∞–∂–¥—ã–µ 30-60 —Å–µ–∫ |

---

## CloudKit Sharing

### Sharing —á–µ–∫–ª–∏—Å—Ç–æ–≤ –º–µ–∂–¥—É —á–ª–µ–Ω–∞–º–∏ —Å–µ–º—å–∏

```dart
// –°–æ–∑–¥–∞—Ç—å share
Future<String> shareChecklist(Checklist checklist) async {
  // 1. –°–æ–∑–¥–∞—Ç—å CKShare
  final share = await cloudKit.createShare(checklist.ckRecord);

  // 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
  share.publicPermission = .none;  // –¢–æ–ª—å–∫–æ –ø–æ —Å—Å—ã–ª–∫–µ

  // 3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
  await cloudKit.save([checklist.ckRecord, share]);

  // 4. –ü–æ–ª—É—á–∏—Ç—å URL
  return share.url;
}

// –ü–æ–∫–∞–∑–∞—Ç—å Share Sheet
Future<void> showShareSheet(String shareUrl) async {
  await Share.share(
    shareUrl,
    subject: '–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ Family Checklist',
  );

  // iOS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç:
  // ‚Ä¢ iMessage
  // ‚Ä¢ Email
  // ‚Ä¢ WhatsApp
  // ‚Ä¢ Telegram
}

// –ü—Ä–∏–Ω—è—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ iOS)
Future<void> acceptShare(CKShareMetadata metadata) async {
  await cloudKit.acceptShare(metadata);
  // –ß–µ–∫–ª–∏—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤–∏—Ç—Å—è –≤ Shared Database
}
```

---

## UI: –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### Dashboard (–ø—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª)

```dart
Widget buildSyncIndicator(SyncStatus status) {
  switch (status) {
    case SyncStatus.enabled:
      return Icon(Icons.cloud_done, color: Colors.green, size: 20);

    case SyncStatus.syncing:
      return Icon(Icons.cloud_sync, color: Colors.blue);

    case SyncStatus.error:
      return IconButton(
        icon: Icon(Icons.cloud_off, color: Colors.orange),
        onTap: () => showSyncErrorDialog(),
      );

    case SyncStatus.disabled:
      return SizedBox.shrink();  // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
  }
}
```

---

## Offline-First Flow

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞:
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí —á–∏—Ç–∞–µ—Ç –∏–∑ Local DB ‚úÖ
2. –û—Ç–º–µ—á–∞–µ—Ç –∑–∞–¥–∞—á—É ‚Üí –ø–∏—à–µ—Ç –≤ Local DB ‚úÖ
3. Sync Service –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å: "task1: ‚úì"
4. UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "‚è± –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è..."

–ü–æ—è–≤–∏–ª—Å—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç:
5. Sync Service –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è
6. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ CloudKit
7. –ü–æ–ª—É—á–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
8. –û–±–Ω–æ–≤–ª—è–µ—Ç Local DB
9. UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
10. –ò–∫–æ–Ω–∫–∞: "‚è±" ‚Üí "‚úì –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ"
```

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ CloudKit –¥–ª—è Family Chart

‚úÖ **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ** –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
‚úÖ **Offline-first** –∏–∑ –∫–æ—Ä–æ–±–∫–∏
‚úÖ **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Sharing** –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
‚úÖ **Conflict resolution** –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π
‚úÖ **Privacy** ‚Äî 100% Apple, GDPR compliant
‚úÖ **–¢–æ–ª—å–∫–æ iOS/iPad** ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤–∞—à–µ–≥–æ —Ç–∞—Ä–≥–µ—Ç–∞

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Supabase

‚ùå **–ù–ï –ù–£–ñ–ï–ù** –¥–ª—è Family Chart, –ø–æ—Ç–æ–º—É —á—Ç–æ:

- –ù–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –ª–æ–≥–∏–∫–∏
- –ù–µ—Ç –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (—Ç–æ–ª—å–∫–æ iOS/iPad)
- CloudKit –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Supabase = –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã (~$25/–º–µ—Å)
- Supabase = –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –æ—Ç–∫–∞–∑–∞

**–í—ã–≤–æ–¥:** CloudKit ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è Family Chart.

---

## Implementation Roadmap

### Phase 2.3: CloudKit Setup
- [ ] –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CloudKit schema
- [ ] Local-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [ ] –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π CloudKit sync layer
- [ ] Conflict resolution
- [ ] Migration: Local ‚Üí Cloud

### Phase 4.4: CloudKit Sync Implementation
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è CloudKit sync layer
- [ ] UI –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Apple CloudKit Documentation](https://developer.apple.com/documentation/cloudkit)
- [CloudKit Best Practices](https://developer.apple.com/videos/play/wwdc2021/10015/)
- [CloudKit Sharing](https://developer.apple.com/documentation/cloudkit/shared_records)
