# Family Checklist — Implementation Plan

## Общая информация о проекте

**Название**: Family Checklist
**Платформа**: Flutter (iOS, Android)
**Бэкенд**:
- Локальное хранилище (SQLite/Hive)
- Firebase Remote Config (настройки, цены, периодичность рекламы)
- Supabase (опционально, при необходимости синхронизации между устройствами)
- iCloud CloudKit (приоритет для iOS для синхронизации)

**Основная цель**: Помочь семьям с детьми 6-12 лет выстроить визуальную систему управления домашними задачами и рутиной.

---

## Этапы реализации

### Фаза 1: HTML-прототипирование интерфейсов

> **Важно**: На этом этапе мы создаём HTML-прототипы экранов, согласовываем визуальную концепцию и UX, затем детально описываем каждый экран в техническом задании перед началом разработки на Flutter.

#### 1.1 Weekly Board (Основной экран с недельной таблицей) ✅

**Процесс**:
1. ✅ Создание HTML-прототипа Weekly Board
2. ✅ Ревью и согласование структуры
3. ✅ Детальное описание в техническое задание:
   - ✅ Структура данных (люди, задачи, дни недели)
   - ✅ Генерация демо данных для WeeklyBoard в json
   - ✅ Визуализация текущего дня (расширенная колонка)
   - ✅ Иконки задач и цветовая система json
   - ✅ Верхняя панель навигации (Назад, Название, Настройки)
   - ✅ Отображение прогресса по задачам
   - ✅ Liquid Design от Apple (карточки имён, прозрачность, тени)
   - ✅ iPhone 16 Pro Dynamic Island

**Результат**: ✅ HTML-прототип (demo-weekly-board.html) + набор демо данных (weekly-board-data.json) + библиотека иконок задач + ✅ iPad Demo версия (demo-ipad.html + demo-ipad-data.json) в горизонтальной ориентации с английским интерфейсом

**Статус**: ✅ Завершён полностью. Переименован в demo-weekly-board.html. Навигация настроена.

---

#### 1.2 Dashboard (Главный экран с прогрессом) ✅

**Процесс**:
1. ✅ Создание HTML-прототипа Dashboard
2. ✅ Ревью и согласование дизайна
3. ✅ Детальное описание в техническое задание:
   - ✅ Карточки активных чеклистов с процентом выполнения (Family Week card)
   - ✅ Прогресс-бары (This Week / Today)
   - ✅ Month Performance с прогрессом по участникам (Best Tasks ≥80%, Needs Attention <60%)
   - ✅ Списки прогресса по участникам с цветными прогресс-барами
   - ✅ Коллапсируемые карточки участников (Kate, Dad)
   - ✅ Быстрые действия (CTA): Edit Family Members, Edit Tasks, Edit Schedule
   - ✅ Liquid Design от Apple
   - ✅ iPhone 16 Pro Dynamic Island
   - ✅ Кнопка "Open Chart" → переход на Weekly Board

**Результат**: ✅ HTML-прототип (demo-dashboard.html) + навигация с weekly-board через demo.html

**Статус**: ✅ Завершён полностью. Переименован в demo-dashboard.html. Навигация настроена.

---

#### 1.3 Onboarding (Экран создания первого чеклиста) ✅

**Процесс**:
1. ✅ Создание HTML-прототипа Onboarding
2. ✅ Ревью и согласование дизайна
3. ✅ Детальное описание в техническое задание:
   - ✅ Screen 0: Welcome screen с превью 3 шагов
   - ✅ Screen 1 (Step 1/3): Управление составом семьи (аватары, имена, возрастные группы)
   - ✅ Screen 2 (Step 2/3): Библиотека задач с иконками, категориями (Daily, Weekly, 3x per Week)
   - ✅ Screen 3 (Step 3/3): Настройка регулярности задач (Weekdays, Weekend, Custom checkboxes)
   - ✅ Paywall: Premium подписка с тарифами (Monthly, Yearly, Lifetime)
   - ✅ Коллапсируемые секции участников с chevron иконками
   - ✅ Поиск задач с фильтрацией по категориям
   - ✅ Кнопка создания кастомных задач
   - ✅ Step indicators (Step X/3)
   - ✅ Liquid Design от Apple
   - ✅ iPhone 16 Pro Dynamic Island
   - ✅ Переход на Weekly Board после завершения

**Результат**: ✅ HTML-прототип (demo-onboarding.html) + демо данные (onboarding-tasks.json) + премиум функции (premium-readme.md)

**Статус**: ✅ Завершён полностью. Включает paywall и полный onboarding flow.

---

#### 1.4 Дополнительные экраны ⏳

**Не реализовано (отложено на Flutter разработку):**
- ⏳ Настройки (Settings screen)
- ⏳ Профиль участника (Member Profile)
- ⏳ Печать/экспорт A4 (Print/Export Preview)

**Результат Фазы 1**: ✅ Полный набор HTML-прототипов всех ключевых экранов:
- ✅ demo-onboarding.html (4 screens + paywall)
- ✅ demo-weekly-board.html (основной экран с таблицей)
- ✅ demo-dashboard.html (главный экран с прогрессом)
- ✅ demo-ipad.html (iPad версия в горизонтальной ориентации)
- ✅ demo.html (навигационный hub для тестирования)
- ✅ Демо данные (JSON): onboarding-tasks.json, weekly-board-data.json, demo-ipad-data.json, dashboard-data.json
- ✅ Документация: premium-readme.md
- ✅ Навигация между экранами настроена

---
### Фаза 2: Подготовка и проектирование App

#### 2.1 Настройка окружения и репозитория
- ✅ Инициализация Flutter проекта
- ✅ Настройка Firebase проекта (Remote Config, Analytics)
- ✅ Настройка Amplitude Analytics (см. [project-config.yaml](../project-config.yaml))
- ✅ Настройка AppMetrica Analytics (см. [project-config.yaml](../project-config.yaml))
- ⏸️ Настройка Supabase проекта (опционально, отложено)
- ✅ Настройка системы контроля версий (Git)
- ✅ Подготовка структуры проекта (архитектура папок)

#### 2.2 Выбор технологического стека
- ✅ State management: **Riverpod** (см. [tech-stack.md](tech-stack.md))
- ✅ Локальная БД: **Isar** (NoSQL, offline-first)
- ✅ Роутинг: **go_router** (официальный от Flutter team)
- ✅ DI: **Riverpod providers** (встроенный)
- ✅ UI библиотеки: **Material 3 + Custom Liquid Design**

**Результат:**
- `pubspec.yaml` обновлен с зависимостями
- Базовая структура папок создана
- Примеры кода для всех технологий готовы
- Документация в [tech-stack.md](tech-stack.md)

#### 2.3 Проектирование CloudKit синхронизации
- ✅ Создание документации [feature-sync-architecture.md](feature-sync-architecture.md)
- ✅ Проектирование CloudKit schema (Checklist, Person, Task, TaskCompletion)
- ✅ Определение стратегии conflict resolution
- ✅ Планирование migration flow: Local → Cloud

**Результат:** Полная архитектурная документация готова. Реализация в Фазе 4.4.

#### 2.4 Проектирование Contacts интеграции
- ✅ Создание документации [feature-family-sharing-integration.md](feature-family-sharing-integration.md)
- ✅ Проектирование onboarding flow с умными предложениями
- ✅ Планирование CloudKit Sharing для приглашений
- ✅ Определение UX для Share Sheet интеграции

**Результат:** Полная документация готова. Реализация в Фазе 3.3 и 4.5.

---
### Фаза 3: MVP — Базовая функциональность

> **Scope MVP**: Weekly Board + создание чеклиста с умными предложениями из Contacts + локальное хранение данных

#### 3.1 Архитектура и модели данных

**Задачи**:
- ✅ Проектирование схемы локальной БД ([docs/3-db-architecture.md](./3-db-architecture.md))
  - Таблица: Users (участники семьи) — int ID autoIncrement
  - Таблица: Checklists (чеклисты) — int ID autoIncrement
  - Таблица: Tasks (задачи) — int ID autoIncrement
  - Таблица: UserTasks (назначения задач) — связь Users + Tasks + Checklists
  - Таблица: TaskCompletions (отметки выполнения по дням/неделям)
  - Таблица: Achievements (достижения пользователей)
  - Таблица: Settings (настройки приложения)
- ✅ Создание Dart моделей (Users, Checklists, Tasks, UserTasks, TaskCompletions, Achievements, Settings)
- ✅ Настройка локального хранилища (Isar — NoSQL embedded database)
- ✅ Репозитории для работы с данными (CRUD операции для всех 7 таблиц)
- ✅ Генерация кода через build_runner (Isar schemas + Riverpod providers)
- ✅ Week Number (ISO 8601) для идентификации недель
- ✅ ISO 8601 стандарт для dayOfWeek (1=Пн, 7=Вс)

---

#### 3.2 Weekly Board — реализация ✅

**Задачи**:
- ✅ UI Weekly Board (таблица люди × задачи × дни)
- ✅ Отображение участников (аватары, имена)
- ✅ Отображение задач с иконками
- ✅ Сетка дней недели (Пн-Вс)
- ✅ Логика отметки выполнения (tap на ячейке)
- ✅ Визуальное выделение текущего дня
- ✅ Подсчёт и отображение прогресса (за день, за неделю)
- ✅ Свайп между днями/неделями (отложено на позже)
- ✅ Верхняя панель навигации

**Результат:**
- Weekly Board полностью реализован на базе HTML прототипа
- Seed data из demo-weekly-board.html загружается в БД
- Responsive layout с Expanded widgets для равномерного распределения
- Иконки 42x42px с inset shadow эффектом для незавершенных задач
- Зеленый градиент для завершенных задач
- Единые линии строк через IntrinsicHeight
- Текущий день выделен голубым фоном и увеличенной шириной
- Звезды на member header для полностью выполненных дней
- Progress bars для каждой задачи
- Bottom navigation для фильтрации по участникам

---

#### 3.3 Onboarding и создание первого чеклиста ✅

**Задачи**:
- ✅ Welcome screen с превью функционала
- ✅ Форма добавления участников семьи (имя, аватар, цвет)
- ✅ Библиотека задач с иконками и категориями
- ✅ Назначение задач участникам
- ✅ Настройка периодичности (ежедневно/по дням/N раз в неделю)
- ✅ Сохранение первого чеклиста в локальную БД
- ✅ Переход на Weekly Board

**Результат:**
- Welcome screen с custom иконкой семьи 180x180px и Lottie анимацией
- Библиотека задач (95+ шаблонов) и иконок (130+) в static data
- Step 1: добавление участников с выбором аватара и цвета (8 preset colors)
- Step 2: выбор и создание задач с поиском и категоризацией
- Step 3: настройка расписания с weekly goal slider и weekday selector
- Multi-step onboarding flow с сохранением в Isar database

---

#### 3.4 Dashboard (упрощённая версия для MVP)

**Задачи**:
- [ ] Список активных чеклистов
- [ ] Карточки чеклистов с прогрессом
- [ ] Быстрое действие: "Создать чеклист"
- [ ] Переход в Weekly Board при клике на чеклист
- [ ] Онбординг для новых пользователей (first-time experience)

---

#### 3.5 Навигация и роутинг

**Задачи**:
- [ ] Настройка go_router
- [ ] Маршруты: Dashboard → Weekly Board → Create/Edit Checklist
- [ ] Deep linking (опционально)

---

#### 3.6 Firebase Remote Config

**Задачи**:
- [ ] Настройка Remote Config в Firebase
- [ ] Параметры: цены, периодичность рекламы, feature flags
- [ ] Загрузка конфига при старте приложения
- [ ] Использование параметров в приложении

---

#### 3.7 Тестирование MVP

**Задачи**:
- [ ] Unit-тесты для бизнес-логики
- [ ] Widget-тесты для основных экранов
- [ ] Внутреннее тестирование на iOS и Android
- [ ] Сбор первичного фидбека

**Результат Фазы 3**: Работающий MVP с Weekly Board, умным onboarding с предложениями из Contacts, локальным хранением данных.

---

### Фаза 4: Расширенная функциональность

#### 4.1 Печать и экспорт A4

**Задачи**:
- [ ] Генерация PDF A4 (горизонтальный формат)
- [ ] Таблица с 7 колонками (Пн-Вс)
- [ ] Добавление QR-кода для OCR
- [ ] Опции печати: текущий день, иконки, экономия чернил
- [ ] Экспорт и сохранение PDF
- [ ] Интеграция с iOS Share Sheet

---

#### 4.2 OCR (Скан по фото)

**Задачи**:
- [ ] Интеграция камеры (camera package)
- [ ] Обнаружение листа и исправление перспективы (opencv/ml_kit)
- [ ] OCR распознавание отметок (ML Kit/Tesseract)
- [ ] Сопоставление отметок с задачами через QR-код
- [ ] Заполнение статусов в чеклисте
- [ ] UI: предпросмотр, подтверждение, отмена

---

#### 4.3 Голосовое наполнение чеклиста через AI

**Задачи**:
- [ ] Интеграция Speech-to-Text (speech_to_text package)
- [ ] Интеграция OpenAI API / Claude API для обработки голосового ввода
- [ ] Парсинг ответа AI в структурированные задачи
- [ ] UI для голосового ввода (кнопка микрофона, индикатор записи)
- [ ] Отображение распознанных задач с возможностью редактирования
- [ ] Добавление задач в чеклист

**Примерный флоу**:
1. Пользователь нажимает кнопку 🎙️
2. Записывается голосовой ввод: "Маша и Петя должны убирать комнату каждый день, выгуливать собаку в понедельник, среду и пятницу, делать уроки каждый день кроме выходных"
3. AI обрабатывает текст и возвращает структурированный JSON с задачами
4. Задачи автоматически добавляются в чеклист с правильными назначениями и периодичностью

---

#### 4.4 Синхронизация между устройствами (CloudKit)

**Задачи**:
- [ ] Реализация CloudKit sync layer (см. [feature-sync-architecture.md](feature-sync-architecture.md))
- [ ] UI для включения/выключения синхронизации в Settings
- [ ] Миграция: Local → Cloud при включении синхронизации
- [ ] Логика разрешения конфликтов (приоритет completed задачам)
- [ ] Индикаторы статуса синхронизации в UI
- [ ] Тестирование синхронизации между iOS устройствами

---

#### 4.5 Многопользовательский доступ и приглашения

**Задачи**:
- [ ] Система приглашений по ссылке
- [ ] Роли: владелец, редактор, наблюдатель
- [ ] Управление участниками домохозяйства
- [ ] Уведомления о приглашениях
- [ ] Совместное редактирование чеклиста

---

#### 4.6 Уведомления

**Задачи**:
- [ ] Push-уведомления (Firebase Cloud Messaging)
- [ ] Локальные уведомления (flutter_local_notifications)
- [ ] Утреннее напоминание (07:30, настраиваемое)
- [ ] Вечерний обзор (19:30, настраиваемое)
- [ ] Напоминание о новой неделе (вс 20:00)
- [ ] Итоги недели
- [ ] Логика "тихих окон" (не пушить при активном использовании)

---

#### 4.7 Dashboard — полная версия

**Задачи**:
- [ ] График динамики (после 2+ недель использования)
- [ ] Списки "приживается/проседает" по участникам
- [ ] Карточки с детальной статистикой
- [ ] Фильтры по периодам (неделя, месяц)
- [ ] Экспорт отчётов

---

#### 4.8 Настройки

**Задачи**:
- [ ] Профиль пользователя
- [ ] Настройки домохозяйства
- [ ] Начало недели (Пн/Вс)
- [ ] Язык (RU/EN)
- [ ] Управление приглашениями и ролями
- [ ] Настройки уведомлений
- [ ] Стиль печати
- [ ] Конфиденциальность, экспорт данных, удаление

---

### Фаза 5: Монетизация и Premium-функции

#### 5.1 Paywall и подписка

**Задачи**:
- [ ] Интеграция RevenueCat / in-app purchases
- [ ] Экран Paywall
- [ ] Подписка Premium (Family Pro): $2.99/мес, $24.99/год
- [ ] 7-дневный trial
- [ ] Apple Family Sharing
- [ ] Ограничения Free-версии:
  - [ ] 1 домохозяйство
  - [ ] 1 приглашённый участник
  - [ ] Реклама при печати PDF
  - [ ] Без OCR и голосового ввода

---

#### 5.2 Реклама (Free-версия)

**Задачи**:
- [ ] Интеграция AdMob / AppLovin
- [ ] Показ рекламы при печати PDF
- [ ] Настройка периодичности через Firebase Remote Config
- [ ] A/B тестирование частоты показов

---

#### 5.3 Premium-функции

**Задачи**:
- [ ] Разблокировка OCR по фото
- [ ] Разблокировка голосового ввода
- [ ] До 6 участников в домохозяйстве
- [ ] Журнал правок и история изменений
- [ ] Расширенные стили печати
- [ ] Отчёты недели/месяца

---

### Фаза 6: Система поощрений (отложено, не в core MVP)

> **Примечание**: Эта фаза реализуется после запуска основного функционала

#### 6.1 Stars, Badges, Rewards

**Задачи**:
- [ ] Проработка механики поощрений
- [ ] Дизайн бейджей и наград
- [ ] Условия получения:
  - 5 дней подряд
  - 100% неделя
  - Командная 90%+
- [ ] UI для отображения достижений
- [ ] Анимации и празднования успехов
- [ ] Система наград от родителей (опционально)

---

### Фаза 7: Полировка и подготовка к релизу

#### 7.1 UI/UX полировка

**Задачи**:
- [ ] Анимации и микроинтеракции
- [ ] Темная тема
- [ ] Адаптация для iPad (split-view)
- [ ] Accessibility (VoiceOver, Dynamic Type)
- [ ] Локализация (RU/EN)

---

#### 7.2 Тестирование

**Задачи**:
- [ ] Полное тестирование на iOS (iPhone, iPad)
- [ ] Полное тестирование на Android (разные размеры экранов)
- [ ] Тестирование offline-режима
- [ ] Тестирование синхронизации
- [ ] Тестирование подписок и покупок
- [ ] Beta-тестирование с реальными семьями

---

#### 7.3 Аналитика

**Задачи**:
- [ ] Настройка Firebase Analytics
- [ ] События:
  - app_open
  - create_checklist
  - print_pdf
  - ocr_applied
  - voice_add_task
  - mark_done
  - invite_sent / invite_accepted
  - paywall_view
  - trial_start
  - subscribe
- [ ] Дашборды в Firebase
- [ ] Целевые метрики:
  - A1 (создал чеклист + ≥1 отметка в D0) ≥60%
  - W1 retention ≥35%
  - P(OCR_try) ≥25% новых пользователей

---

#### 7.4 Подготовка к релизу

**Задачи**:
- [ ] App Store страница (скриншоты, описание, ключевые слова)
- [ ] Google Play страница
- [ ] Privacy Policy
- [ ] Terms of Service
- [ ] App Store Review подготовка (demo аккаунт, инструкции)
- [ ] Submission в App Store
- [ ] Submission в Google Play

---

### Фаза 8: Пост-релиз и итерации

#### 8.1 Мониторинг и поддержка

**Задачи**:
- [ ] Мониторинг аналитики
- [ ] Сбор отзывов пользователей
- [ ] Исправление критических багов
- [ ] Ответы на отзывы в App Store / Google Play

---

#### 8.2 Итерации на основе фидбека

**Задачи**:
- [ ] Анализ поведения пользователей
- [ ] Приоритизация новых функций
- [ ] A/B тестирование изменений
- [ ] Регулярные обновления

---

## Технологический стек (предварительный)

### Frontend (Flutter)
- **Framework**: Flutter 3.x
- **State Management**: Riverpod / Bloc
- **Routing**: go_router
- **DI**: get_it / riverpod
- **Local DB**: Hive / Isar
- **UI**: Material 3 + Custom Design System

### Backend & Services
- **Remote Config**: Firebase Remote Config
- **Analytics**: Firebase Analytics
- **Push Notifications**: Firebase Cloud Messaging
- **Sync (if needed)**: Supabase / CloudKit
- **Auth**: Apple Sign In + Supabase Auth (если используем Supabase)

### AI & ML
- **Speech-to-Text**: speech_to_text package
- **AI Processing**: OpenAI API / Claude API
- **OCR**: ML Kit / Tesseract

### Monetization
- **In-App Purchases**: RevenueCat / in_app_purchase
- **Ads**: AdMob / AppLovin

### Other
- **PDF Generation**: pdf package
- **Camera**: camera package
- **Image Processing**: image_picker, opencv, ml_kit
- **QR Code**: qr_flutter

---

## Ключевые риски и вопросы

1. **Синхронизация без бэкенда**: Нужно оценить возможности CloudKit для cross-device sync на iOS/Android. Если недостаточно → Supabase.

2. **OCR точность**: Распознавание галочек на фото может требовать обучения ML-модели или использования специальных маркеров.

3. **AI обработка голоса**: Стоимость API вызовов OpenAI/Claude. Возможно, нужно ограничение в Free-версии.

4. **Многопользовательские конфликты**: Логика разрешения конфликтов при одновременном редактировании.

5. **Монетизация**: Баланс между Free и Premium. Нужно не задушить Free-версию, но дать ценность Premium.

---

## Roadmap (примерные сроки)

| Фаза | Описание | Оценка времени |
|------|----------|----------------|
| Фаза 1 | HTML-прототипирование (Weekly Board, Dashboard, Create) + демо данные + иконки | 2-3 недели |
| Фаза 2 | Подготовка и проектирование | 1 неделя |
| Фаза 3 | MVP (Weekly Board + AI голосовой ввод + локальное хранение) | 4-6 недель |
| Фаза 4 | Расширенная функциональность (Печать, OCR, Sync, Notifications) | 6-8 недель |
| Фаза 5 | Монетизация и Premium | 2-3 недели |
| Фаза 6 | Система поощрений (отложено) | 2-3 недели |
| Фаза 7 | Полировка и подготовка к релизу | 3-4 недели |
| Фаза 8 | Пост-релиз | ongoing |

**Общая оценка до первого релиза**: 4-6 месяцев

---

## Следующие шаги

1. ✅ Согласовать Implementation Plan
2. ✅ Начать Фазу 1: HTML-прототипирование Weekly Board
3. ✅ Создать демо данные (JSON) и библиотеку иконок задач
4. ✅ HTML-прототип Dashboard
5. ✅ HTML-прототип Onboarding с Paywall
6. ✅ Связать все экраны навигацией
7. ✅ **Фаза 1 завершена!** Все ключевые HTML прототипы готовы
8. ⏭️ Создать детальное ТЗ для Flutter разработки на основе прототипов
9. ⏭️ Инициализация Flutter проекта (Фаза 2)
10. ⏭️ Начать разработку MVP (Фаза 3)
